generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String         @id @default(uuid())
  email         String         @unique
  password      String
  token         String?
  createdAt     DateTime       @default(now())
  name          String
  interventions Intervention[]
}

model Intervention {
  id          String      @id @default(uuid())
  titre       String
  dateStart   String
  dateEnd     String
  status      Int
  priority    String
  customer    String
  long        Float
  lat         Float
  distance    Float
  description String
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  userId      String
  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  materiels   Materiel[]
  timesheets  Timesheet[]
  
  // Relations avec Image, Document, Comment et Signature
  images      Image[]
  documents   Document[]
  comments    Comment[]
  signatures  Signature[]
}

model Materiel {
  id             String       @id @default(uuid())
  name           String
  quantity       Int
  idIntervention String
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  intervention   Intervention @relation(fields: [idIntervention], references: [id], onDelete: Cascade)
}

model Timesheet {
  id             String       @id @default(uuid())
  description    String
  timeAllocated  Float
  date           String
  idIntervention String
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  intervention   Intervention @relation(fields: [idIntervention], references: [id], onDelete: Cascade)
}

model Image {
  id             String       @id @default(uuid())
  filename       String
  data           String       @db.Text
  idIntervention String
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  // Relation avec Intervention
  intervention   Intervention @relation(fields: [idIntervention], references: [id], onDelete: Cascade)
}

model Document {
  id             String       @id @default(uuid())
  filename       String
  data           String       @db.Text
  idIntervention String
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  // Relation avec Intervention
  intervention   Intervention @relation(fields: [idIntervention], references: [id], onDelete: Cascade)
}

model Comment {
  id             String       @id @default(uuid())
  message        String       @db.Text
  date           String
  attachmentData String?      @db.Text
  attachmentFilename String?
  idIntervention String
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  // Relation avec Intervention
  intervention   Intervention @relation(fields: [idIntervention], references: [id], onDelete: Cascade)
}

model Signature {
  id             String       @id @default(uuid())
  filename       String
  data           String       @db.Text
  idIntervention String
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  // Relation avec Intervention
  intervention   Intervention @relation(fields: [idIntervention], references: [id], onDelete: Cascade)
}
